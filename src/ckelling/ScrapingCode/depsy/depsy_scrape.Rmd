---
title: "Depsy Scraping"
author: "Claire Kelling"
date: "6/26/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Now that we have all of the possible packages from the cran website, we will pull all of the dependencies and create an edgelist from the neighbors listed in Depsy. 

We will also record features of the nodes, such as downloads and number of contributors. 

This is done using the Depsy API and the rjson package. 

First, I will load the list of all packages that I have scraped from the Cran list. 
```{r load nodes}
library(rvest)
library(rjson)
load(file= '~/git/oss/data/oss/original/depsy/all_packages_cran.Rdata')
```

Now, I will create two datasets: one is an edgelist and one is talking about nodal features. 

```{r nodal features}
#API for GGplot: http://depsy.org/api/package/cran/ggplot2
name_vec <- as.vector(all_packages$oss_name)

test <- c()
error_vec <- c()

error_message<- "Error in"
for(i in 1:length(name_vec)){
  link <- paste('http://depsy.org/api/package/cran/', name_vec[i], sep='')
  print(i)
  test <- try(read_html(link))
  error_test <- substr(test[1], 1, 8)
  if(error_test == error_message){
    error_vec <- rbind(error_vec, i)
  }
}

length(error_vec)
save(error_vec, file = "~/git/oss/data/oss/original/depsy/error_vector.Rdata")
```

```{r constructing nodes}
load(file = "~/git/oss/data/oss/original/depsy/error_vector.Rdata")
load(file= '~/git/oss/data/oss/original/depsy/all_packages_cran.Rdata')

length(error_vec)/nrow(all_packages) #10.2% of the R packages on Cran are on Depsy
nrow(all_packages)-length(error_vec) #there are 9,810 R packages on Depsy

#Creating list of all packages on Cran and Depsy
depsy_packages <- all_packages[-error_vec,] #these are the 9,810 R packages on Depsy and cran

for(i in 1:length(depsy_packages)){
  #scrape details from API using rjson
}
```

```{r edge list}
edge_list
for(i in 1:length(depsy_packages)){
  #form edge list of all neighbor_id's that start with cran:
}
```

